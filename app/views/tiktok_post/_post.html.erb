<% likes_count = post.likes_count.to_i %>
<% comments_count = post.comments_count.to_i %>
<% play_count = post.play_count.to_i %>
<% shares_count = post.shares_count.to_i %>
<% total_interactions = likes_count + comments_count + shares_count %>
<% engagement_rate = post.tiktok_profile.followers > 0 ? ((total_interactions.to_f / post.tiktok_profile.followers) * 100).round(2) : 0 %>
<% posted_on_text = post.posted_at.present? ? l(post.posted_at, format: :long) : nil %>
<% posted_on_iso = post.posted_at&.iso8601 %>
<% permalink = "https://www.tiktok.com/@#{post.tiktok_profile.display_username}/video/#{post.tiktok_post_id}" %>
<% compact_units = { thousand: 'K', million: 'M', billion: 'B' } %>

<%if post.cover.attached? || post.cover_url.present?%>
  <div class="group relative break-inside-avoid mb-8">
    <!-- Card Container -->
    <div class="relative overflow-hidden rounded-2xl bg-white shadow-md ring-1 ring-gray-900/5 transition-all duration-500 hover:shadow-2xl hover:-translate-y-2">
      
      <!-- TikTok Badge - Top Left -->
      <div class="absolute top-4 left-4 z-20">
        <div class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-pink-500 to-red-600 shadow-lg">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-white">
            <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.2.19-1.27.41-2.42 1.33-2.98 2.59-.63 1.38-.6 2.99-.24 4.43.62 2.29 2.57 4.03 4.94 4.47 1.75.33 3.64.13 5.24-.72 1.78-.95 2.99-2.7 3.25-4.64.06-.52.08-1.05.07-1.57 0-2.35-.01-4.7.02-7.05.08-1.4.54-2.79 1.35-3.94 1.31-1.92 3.58-3.17 5.91-3.21 1.43-.08 2.86.31 4.08 1.03 2.02 1.19 3.44 3.37 3.65 5.71.02.5.03 1 .01 1.49-.18 1.9-1.12 3.72-2.58 4.96-1.66 1.44-3.98 2.13-6.15 1.72-.02-1.48.04-2.96.04-4.44.99.32 2.15.23 3.2-.19 1.27-.41 2.42-1.33 2.98-2.59.63-1.38.6-2.99.24-4.43-.62-2.29-2.57-4.03-4.94-4.47-1.75-.33-3.64-.13-5.24.72-1.78.95-2.99 2.7-3.25 4.64-.06.52-.08 1.05-.07 1.57 0 2.35.01 4.7-.02 7.05-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.2.19-1.27.41-2.42 1.33-2.98 2.59-.63 1.38-.6 2.99-.24 4.43.62 2.29 2.57 4.03 4.94 4.47 1.75.33 3.64.13 5.24-.72 1.78-.95 2.99-2.7 3.25-4.64.06-.52.08-1.05.07-1.57 0-2.35.01-4.7-.02-7.05z"/>
          </svg>
          <span class="text-xs font-bold text-white uppercase tracking-wider">Video</span>
        </div>
      </div>
      
      <!-- Cover Image Container - Dynamic Height -->
      <div class="relative w-full overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200">
        <%= link_to permalink, target: "_blank", rel: "noopener", class: 'block w-full' do %>
                <% if post.cover.attached? %>
                  <%= image_tag(direct_blob_url(post.cover),
                      class: 'w-full h-auto object-cover transition-all duration-700 group-hover:scale-110 group-hover:brightness-110',
                      loading: 'lazy',
                      decoding: 'async',
                      alt: "Video de #{post.tiktok_profile.display_username} - #{post.desc&.truncate(100) || 'TikTok'}"
                  ) %>
                <% elsif post.cover_url.present? %>
                  <%= image_tag(post.cover_url,
                      class: 'w-full h-auto object-cover transition-all duration-700 group-hover:scale-110 group-hover:brightness-110',
                      loading: 'lazy',
                      decoding: 'async',
                      alt: "Video de #{post.tiktok_profile.display_username} - #{post.desc&.truncate(100) || 'TikTok'}"
                  ) %>
                <% end %>
          
          <!-- Gradient Overlay -->
          <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
          
          <!-- Hover Stats Overlay - Premium Info -->
          <div class="absolute inset-x-0 bottom-0 z-10 p-6 transform translate-y-full group-hover:translate-y-0 transition-transform duration-500">
            <div class="space-y-3">
              <!-- Engagement Stats -->
              <div class="flex items-center gap-3 flex-wrap">
                <!-- Likes -->
                <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-pink-500 to-red-500 shadow-xl">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-white">
                    <path d="m9.653 16.915-.005-.003-.019-.01a20.759 20.759 0 0 1-1.162-.682 22.045 22.045 0 0 1-2.582-1.9C4.045 12.733 2 10.352 2 7.5a4.5 4.5 0 0 1 8-2.828A4.5 4.5 0 0 1 18 7.5c0 2.852-2.044 5.233-3.885 6.82a22.049 22.049 0 0 1-3.744 2.582l-.019.01-.005.003h-.002a.739.739 0 0 1-.69.001l-.002-.001Z" />
                  </svg>
                  <span class="text-sm font-bold text-white">
                    <%= number_to_human(likes_count, format: '%n%u', units: compact_units, precision: 1) %>
                  </span>
                </div>
                
                <!-- Comments -->
                <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/95 backdrop-blur-md shadow-xl border border-white/20">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-pink-600">
                    <path fill-rule="evenodd" d="M10 3c-4.31 0-8 3.033-8 7 0 2.024.978 3.825 2.499 5.085a3.478 3.478 0 0 1-.522 1.756.75.75 0 0 0 .584 1.143 5.976 5.976 0 0 0 3.936-1.108c.487.082.99.124 1.503.124 4.31 0 8-3.033 8-7s-3.69-7-8-7Zm0 8a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm-2-1a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm5 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm font-bold text-gray-900">
                    <%= number_to_human(comments_count, format: '%n%u', units: compact_units, precision: 1) %>
                  </span>
                </div>
                
                <!-- Views -->
                <% if play_count.positive? %>
                  <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600 shadow-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-white">
                      <path d="M6.3 2.84A1.5 1.5 0 0 0 4 4.11v11.78a1.5 1.5 0 0 0 2.3 1.27l9.344-5.891a1.5 1.5 0 0 0 0-2.538L6.3 2.841Z" />
                    </svg>
                    <span class="text-sm font-bold text-white">
                      <%= number_to_human(play_count, format: '%n%u', units: compact_units, precision: 1) %>
                    </span>
                    <span class="text-xs font-medium text-purple-100">views</span>
                  </div>
                <% end %>
                
                <!-- Shares -->
                <% if shares_count.positive? %>
                  <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/95 backdrop-blur-md shadow-xl border border-white/20">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 text-gray-600">
                      <path d="M13 4.5a2.5 2.5 0 1 1 .702 1.737L6.97 9.604a2.518 2.518 0 0 1 0 .792l6.733 3.367a2.5 2.5 0 1 1-.671 1.341l-6.733-3.367a2.5 2.5 0 1 1 0-3.475l6.733-3.366A2.52 2.52 0 0 1 13 4.5Z" />
                    </svg>
                    <span class="text-sm font-bold text-gray-900">
                      <%= number_to_human(shares_count, format: '%n%u', units: compact_units, precision: 1) %>
                    </span>
                  </div>
                <% end %>
              </div>
              
              <!-- CTA Button -->
              <div class="flex items-center justify-between pt-2">
                <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-pink-500 via-red-500 to-black shadow-xl">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-white">
                    <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.2.19-1.27.41-2.42 1.33-2.98 2.59-.63 1.38-.6 2.99-.24 4.43.62 2.29 2.57 4.03 4.94 4.47 1.75.33 3.64.13 5.24-.72 1.78-.95 2.99-2.7 3.25-4.64.06-.52.08-1.05.07-1.57 0-2.35-.01-4.7.02-7.05.08-1.4.54-2.79 1.35-3.94 1.31-1.92 3.58-3.17 5.91-3.21 1.43-.08 2.86.31 4.08 1.03 2.02 1.19 3.44 3.37 3.65 5.71.02.5.03 1 .01 1.49-.18 1.9-1.12 3.72-2.58 4.96-1.66 1.44-3.98 2.13-6.15 1.72-.02-1.48.04-2.96.04-4.44.99.32 2.15.23 3.2-.19 1.27-.41 2.42-1.33 2.98-2.59.63-1.38.6-2.99.24-4.43-.62-2.29-2.57-4.03-4.94-4.47-1.75-.33-3.64-.13-5.24.72-1.78.95-2.99 2.7-3.25 4.64-.06.52-.08 1.05-.07 1.57 0 2.35.01 4.7-.02 7.05-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.2.19-1.27.41-2.42 1.33-2.98 2.59-.63 1.38-.6 2.99-.24 4.43.62 2.29 2.57 4.03 4.94 4.47 1.75.33 3.64.13 5.24-.72 1.78-.95 2.99-2.7 3.25-4.64.06-.52.08-1.05.07-1.57 0-2.35.01-4.7-.02-7.05z"/>
                  </svg>
                  <span class="text-xs font-bold text-white uppercase tracking-wider">Ver en TikTok</span>
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-white">
                    <path fill-rule="evenodd" d="M3 10a.75.75 0 0 1 .75-.75h10.638L10.23 5.29a.75.75 0 1 1 1.04-1.08l5.5 5.25a.75.75 0 0 1 0 1.08l-5.5 5.25a.75.75 0 1 1-1.04-1.08l4.158-3.96H3.75A.75.75 0 0 1 3 10Z" clip-rule="evenodd" />
                  </svg>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
      
      <!-- Content Section - Enhanced -->
      <div class="relative p-6 bg-gradient-to-b from-white to-gray-50">
        <div class="space-y-3">
          <!-- Date -->
          <div class="flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-gray-400">
              <path fill-rule="evenodd" d="M5.75 2a.75.75 0 0 1 .75.75V4h7V2.75a.75.75 0 0 1 1.5 0V4h.25A2.75 2.75 0 0 1 18 6.75v8.5A2.75 2.75 0 0 1 15.25 18H4.75A2.75 2.75 0 0 1 2 15.25v-8.5A2.75 2.75 0 0 1 4.75 4H5V2.75A.75.75 0 0 1 5.75 2Zm-1 5.5c-.69 0-1.25.56-1.25 1.25v6.5c0 .69.56 1.25 1.25 1.25h10.5c.69 0 1.25-.56 1.25-1.25v-6.5c0-.69-.56-1.25-1.25-1.25H4.75Z" clip-rule="evenodd" />
            </svg>
            <time datetime="<%= posted_on_iso %>" class="text-sm font-medium text-gray-600">
              <%= post.posted_at.strftime("%d/%m/%Y") if post.posted_at %>
            </time>
          </div>
          
          <!-- Caption -->
          <% if post.desc.present? %>
            <p class="text-sm text-gray-700 line-clamp-3"><%= truncate(post.desc, length: 150) %></p>
          <% end %>
          
          <!-- Quick Stats Bar -->
          <div class="flex items-center gap-4 pt-3 border-t border-gray-200">
            <!-- Likes -->
            <div class="flex items-center gap-1.5">
              <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-pink-50 text-pink-600">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                  <path d="m9.653 16.915-.005-.003-.019-.01a20.759 20.759 0 0 1-1.162-.682 22.045 22.045 0 0 1-2.582-1.9C4.045 12.733 2 10.352 2 7.5a4.5 4.5 0 0 1 8-2.828A4.5 4.5 0 0 1 18 7.5c0 2.852-2.044 5.233-3.885 6.82a22.049 22.049 0 0 1-3.744 2.582l-.019.01-.005.003h-.002a.739.739 0 0 1-.69.001l-.002-.001Z" />
                </svg>
              </div>
              <div class="flex flex-col">
                <span class="text-xs font-bold text-gray-900 leading-none">
                  <%= number_to_human(likes_count, format: '%n%u', units: compact_units, precision: 1) %>
                </span>
                <span class="text-[10px] text-gray-500 leading-none mt-0.5">likes</span>
              </div>
            </div>
            
            <!-- Comments -->
            <div class="flex items-center gap-1.5">
              <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-blue-50 text-blue-600">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                  <path fill-rule="evenodd" d="M10 3c-4.31 0-8 3.033-8 7 0 2.024.978 3.825 2.499 5.085a3.478 3.478 0 0 1-.522 1.756.75.75 0 0 0 .584 1.143 5.976 5.976 0 0 0 3.936-1.108c.487.082.99.124 1.503.124 4.31 0 8-3.033 8-7s-3.69-7-8-7Zm0 8a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm-2-1a1 1 0 1 1-2 0 1 1 0 0 1 2 0Zm5 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z" clip-rule="evenodd" />
                </svg>
              </div>
              <div class="flex flex-col">
                <span class="text-xs font-bold text-gray-900 leading-none">
                  <%= number_to_human(comments_count, format: '%n%u', units: compact_units, precision: 1) %>
                </span>
                <span class="text-[10px] text-gray-500 leading-none mt-0.5">comments</span>
              </div>
            </div>
            
            <!-- Views -->
            <% if play_count.positive? %>
              <div class="flex items-center gap-1.5">
                <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-purple-50 text-purple-600">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                    <path d="M6.3 2.84A1.5 1.5 0 0 0 4 4.11v11.78a1.5 1.5 0 0 0 2.3 1.27l9.344-5.891a1.5 1.5 0 0 0 0-2.538L6.3 2.841Z" />
                  </svg>
                </div>
                <div class="flex flex-col">
                  <span class="text-xs font-bold text-gray-900 leading-none">
                    <%= number_to_human(play_count, format: '%n%u', units: compact_units, precision: 1) %>
                  </span>
                  <span class="text-[10px] text-gray-500 leading-none mt-0.5">views</span>
                </div>
              </div>
            <% end %>
            
            <!-- Engagement Rate -->
            <% if engagement_rate > 0 %>
              <div class="ml-auto flex items-center gap-1.5">
                <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-green-50 text-green-600">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm.75-11.25a.75.75 0 0 0-1.5 0v2.5h-2.5a.75.75 0 0 0 0 1.5h2.5v2.5a.75.75 0 0 0 1.5 0v-2.5h2.5a.75.75 0 0 0 0-1.5h-2.5v-2.5Z" clip-rule="evenodd" />
                  </svg>
                </div>
                <div class="flex flex-col">
                  <span class="text-xs font-bold text-gray-900 leading-none"><%= engagement_rate %>%</span>
                  <span class="text-[10px] text-gray-500 leading-none mt-0.5">engage</span>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
      
      <!-- Animated Border on Hover -->
      <div class="absolute inset-0 rounded-2xl ring-2 ring-pink-500 opacity-0 scale-95 group-hover:opacity-100 group-hover:scale-100 transition-all duration-500 pointer-events-none"></div>
      
      <!-- Corner Accent -->
      <div class="absolute -top-1 -right-1 w-20 h-20 bg-gradient-to-br from-pink-500/10 to-red-500/10 rounded-full blur-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
    </div>
  </div>
<%end%>

